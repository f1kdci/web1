<!DOCTYPE html>
<html lang="hu">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web-programozás-1 Előadás Házi feladat</title>
  <link rel="stylesheet" href="index.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
  <header>
    <h1>Web-programozás-1 Előadás Házi feladat</h1>
  </header>

  <nav>
    <ul>
        <li><a href="tablazat.html" class="active">Táblázat</a></li>
        <li><a href="html5.html">HTML5</a></li>
        <li><a href="chartjs.html">ChartJS</a></li>
        <li><a href="ajax.html">AJAX</a></li>
        <li><a href="oojs.html">OOJS</a></li>
    </ul>
</nav>

  <main>

    <aside class="sidebar">
      <img src="sidebar.png" class="img-fluid" alt="Sidebar Image">
    </aside>

    <div>
      <h2>Projektkövető</h2>
      <div class="search-container">
        <input type="text" id="searchInput" placeholder="Keresés..." style="flex-grow: 1;">
        <button id="resetBtn" class="cancel">Törlés</button>
      </div>

      <form onsubmit="onFormSubmit(); return false;">
        <label for="projectName">Projekt neve:</label>
        <input type="text" id="projectName" placeholder="Projekt neve" required>

        <label for="status">Státusz:</label>
        <select id="status" required>
          <option value="" disabled selected>Válassz státuszt</option>
          <option value="Folyamatban">Folyamatban</option>
          <option value="Befejezve">Befejezve</option>
          <option value="Félbehagyva">Félbehagyva</option>
        </select>

        <label for="startDate">Kezdés dátuma:</label>
        <input type="date" id="startDate" required>

        <label for="endDate">Befejezés dátuma:</label>
        <input type="date" id="endDate">

        <button type="submit">Mentés</button>
      </form>

      <table id="simpleProjectTable">
        <thead>
          <tr>
            <th onclick="sortTable(0)">Projekt neve</th>
            <th onclick="sortTable(1)">Státusz</th>
            <th onclick="sortTable(2)">Kezdés</th>
            <th onclick="sortTable(3)">Befejezés</th>
            <th>Műveletek</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
 

  </main>
  
  <script>
    
    var selectedRow = null; // A táblázatban kiválasztott sor nyomon követése

    // Űrlap beküldésekor meghívott függvény
    function onFormSubmit() {
        if (validateForm()) { // Ellenőrzi az űrlap érvényességét
            var formData = readFormData(); // Beolvassa az űrlap adatait
            if (selectedRow == null)
                insertNewRecord(formData); // Új rekordot ad hozzá a táblázathoz
            else
                updateRecord(formData); // Frissíti a meglévő rekordot
            resetForm(); // Törli az űrlap mezőit
        }
    }

    // Az űrlap adatainak érvényességét ellenőrzi
    function validateForm() {
        let isValid = true;

        // Projekt név ellenőrzése
        const projectName = document.getElementById("projectName");
        if (projectName.value.trim() === "") {
            alert("A projekt neve nem lehet üres!");
            isValid = false;
        }

        // Státusz ellenőrzése
        const status = document.getElementById("status");
        if (status.value.trim() === "") {
            alert("A státusz nem lehet üres!");
            isValid = false;
        }

        // Kezdés dátumának ellenőrzése
        const startDate = document.getElementById("startDate");
        if (startDate.value === "") {
            alert("A kezdés dátuma nem lehet üres!");
            isValid = false;
        }

        // Befejezés dátumának ellenőrzése (ha meg van adva, akkor későbbinek kell lennie, mint a kezdés dátuma)
        const endDate = document.getElementById("endDate");
        if (endDate.value !== "" && new Date(endDate.value) < new Date(startDate.value)) {
            alert("A befejezés dátuma nem lehet korábbi, mint a kezdés dátuma!");
            isValid = false;
        }

        return isValid; // Visszaadja, hogy az űrlap érvényes-e
    }

    // Beolvassa az űrlap mezőinek adatait
    function readFormData() {
        var formData = {};
        formData["name"] = document.getElementById("projectName").value;
        formData["status"] = document.getElementById("status").value;
        formData["startDate"] = document.getElementById("startDate").value;
        formData["endDate"] = document.getElementById("endDate").value;
        return formData;
    }

    // Új rekordot ad hozzá a táblázathoz
    function insertNewRecord(data) {
        var table = document.getElementById("simpleProjectTable").getElementsByTagName('tbody')[0];
        var newRow = table.insertRow(table.rows.length);

        newRow.insertCell(0).innerHTML = data.name;
        newRow.insertCell(1).innerHTML = data.status;
        newRow.insertCell(2).innerHTML = data.startDate;
        newRow.insertCell(3).innerHTML = data.endDate;

        // Műveletek oszlop hozzáadása (Szerkesztés és Törlés gombok)
        newRow.insertCell(4).innerHTML = `
              <button onClick="onEdit(this)">Szerkesztés</button>
              <button onClick="onDelete(this)">Törlés</button>
            `;
    }

    // Rekord szerkesztése
    function onEdit(td) {
        selectedRow = td.parentElement.parentElement; // A kiválasztott sor
        document.getElementById("projectName").value = selectedRow.cells[0].innerHTML;
        document.getElementById("status").value = selectedRow.cells[1].innerHTML;
        document.getElementById("startDate").value = selectedRow.cells[2].innerHTML;
        document.getElementById("endDate").value = selectedRow.cells[3].innerHTML;
    }

    // Rekord frissítése
    function updateRecord(formData) {
        selectedRow.cells[0].innerHTML = formData.name;
        selectedRow.cells[1].innerHTML = formData.status;
        selectedRow.cells[2].innerHTML = formData.startDate;
        selectedRow.cells[3].innerHTML = formData.endDate;
    }

    // Rekord törlése
    function onDelete(td) {
        if (confirm('Biztos törölni szeretnéd?')) {
            var row = td.parentElement.parentElement;
            document.getElementById("simpleProjectTable").deleteRow(row.rowIndex);
            resetForm(); // Az űrlap mezőinek törlése
        }
    }

    // Az űrlap mezőinek alaphelyzetbe állítása
    function resetForm() {
        document.getElementById("projectName").value = "";
        document.getElementById("status").value = "";
        document.getElementById("startDate").value = "";
        document.getElementById("endDate").value = "";
        selectedRow = null;
    }

    // Alapértelmezett adatok betöltése a táblázatba
    document.addEventListener("DOMContentLoaded", () => {
        const defaultData = [
            { name: "Amigurumi nyuszi", status: "Folyamatban", startDate: "2025-01-10", endDate: "" },
            { name: "Granny takaró", status: "Befejezve", startDate: "2024-11-01", endDate: "2025-02-20" },
            { name: "Téli sapka", status: "Félbehagyva", startDate: "2025-02-15", endDate: "2025-02-20" },
            { name: "Baba kesztyű", status: "Folyamatban", startDate: "2025-03-01", endDate: "" }
        ];

        defaultData.forEach(data => insertNewRecord(data));
    });

    // Keresési funkció
    document.getElementById("searchInput").addEventListener("input", function () {
        const searchInput = this.value.toLowerCase();
        const rows = document.querySelectorAll("#simpleProjectTable tbody tr");

        rows.forEach(row => {
            const rowText = row.innerText.toLowerCase();
            row.style.display = rowText.includes(searchInput) ? "" : "none";
        });
    });

    // Keresési mező törlése
    document.getElementById("resetBtn").addEventListener("click", function () {
        document.getElementById("searchInput").value = "";
        const rows = document.querySelectorAll("#simpleProjectTable tbody tr");
        rows.forEach(row => row.style.display = "");
    });

    // Táblázat rendezése oszlop szerint
    function sortTable(columnIndex) {
        const table = document.getElementById("simpleProjectTable");
        const tbody = table.getElementsByTagName("tbody")[0];
        const rows = Array.from(tbody.getElementsByTagName("tr"));

        const isAscending = table.getAttribute("data-sort-order") === "asc";
        table.setAttribute("data-sort-order", isAscending ? "desc" : "asc");

        rows.sort((a, b) => {
            const cellA = a.getElementsByTagName("td")[columnIndex].innerText.toLowerCase();
            const cellB = b.getElementsByTagName("td")[columnIndex].innerText.toLowerCase();

            if (columnIndex === 2 || columnIndex === 3) { // Dátumok rendezése
                return isAscending
                    ? new Date(cellA) - new Date(cellB)
                    : new Date(cellB) - new Date(cellA);
            }

            return isAscending
                ? cellA.localeCompare(cellB)
                : cellB.localeCompare(cellA);
        });

        rows.forEach(row => tbody.appendChild(row)); // Sorok újrarendezése a táblázatban
    }
    </script>
  <footer>
    <p>Laczikó Henrietta - F1KDCI</p>
  </footer>
</body>

</html>